# AST API Reference

## Creating an AST

The AST (Abstract Syntax Tree) is usually created in Javascript with a parsing API:

`ParseCurrentFile([options])` parses the current file and returns an AST.

`ParseCode(code, [options])` parses the provided code string into an AST.

Alternatively, we can also create an in-line AST by wrapping raw code with `.()` in an ama script.

### Parsing Options

TODO: default_options

## The Node Class

The `Node` class represents an AST node. It's available in C++ as `ama::Node` and available in Javascript as `Node`.

The Javascript `Node` global name refers to a prototype object and cannot be used directly for construction. Nodes have to be constructed with `node_class`-specific `nFoo` global functions, or created with the parsing functions.

The AST makes extensive use of doubly-linked lists. The links are exposed as mutable fields of `Node` with one-letter names: `.c .s .p .v`. Modifying those fields is not memory-safe, even in Javascript. We recommend mutating trees with methods like `Insert` and `Unlink` instead of modifying the fields directly, unless the task is really creative, 

### Fields

【fields】
### Common Methods

Unless otherwise specified, the following methods are supported in both C++ and Javascript:

【apis_cpp】
--------------
- `nd.NodeofToASTExpression()`

Translate `.()` to Javascript node construction expression. Useful if we eventually run the AST in our own scripting context.

--------------
- `nd.AutoFormat()`

Format the AST with sane indentations. Useful on generated code before dumping.

### Methods

The following methods are only supported in Javascript:

【apis_js】
## Node Types

【ctor】
## Notes

`doc/api_node.md` is automatically generated by `script/docgen.ama.js`. If we want to edit this document, edit `script/doc_templates/node.md` instead.
